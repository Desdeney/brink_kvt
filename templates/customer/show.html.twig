{% extends 'base.html.twig' %}

{% block title %}Kunde: {{ customer.prename }} {{ customer.lastname }} - Brink VA{% endblock %}

{% block body %}
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-id-card text-primary"></i>Kundendetails: {{ customer.prename }} {{ customer.lastname }}
        </h1>
        <div class="page-actions">
            <a href="{{ path('app_customer_index') }}" class="btn btn-outline-secondary btn-standard shadow-sm">
                <i class="fas fa-arrow-left me-2"></i>Zurück zur Übersicht
            </a>
            <a href="{{ path('app_customer_edit', {'id': customer.id}) }}" class="btn btn-primary btn-standard shadow-sm" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <i class="fas fa-edit me-2"></i>Bearbeiten
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Customer Info Card -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow-lg mb-4 border-0" style="border-radius: 15px; overflow: hidden;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                    <h6 class="m-0 font-weight-bold text-white"><i class="fas fa-user-tag me-2"></i>Basisdaten</h6>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <img class="img-profile rounded-circle mb-3" src="{{ asset('img/avatar.png') }}" width="100">
                        <h4 class="font-weight-bold">{{ customer.prename }} {{ customer.lastname }}</h4>
                        <span class="text-muted">ID: {{ customer.id }}</span>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="small font-weight-bold text-gray-600 d-block">E-Mail</label>
                        <span>{{ customer.email }}</span>
                    </div>
                    <div class="mb-3">
                        <label class="small font-weight-bold text-gray-600 d-block">Telefon</label>
                        <span>{{ customer.phone }}</span>
                    </div>
                </div>
            </div>

            <div class="card shadow-lg mb-4 border-0" style="border-radius: 15px; overflow: hidden;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%); border: none;">
                    <h6 class="m-0 font-weight-bold text-white"><i class="fas fa-wallet me-2"></i>Zahlungseinstellungen</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="small font-weight-bold text-gray-600 d-block">Zahlungsart</label>
                        <span>{{ customer.payment.name|default('Nicht definiert') }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="small font-weight-bold text-gray-600">Barzahlung erforderlich:</span>
                        <span>{{ customer.requireCash ? '<span class="text-danger">Ja</span>' : 'Nein' }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="small font-weight-bold text-gray-600">Vorkasse erforderlich:</span>
                        <span>{{ customer.requirePrepaid ? '<span class="text-danger">Ja</span>' : 'Nein' }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Address and Appointments -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow-lg mb-4 border-0" style="border-radius: 15px; overflow: hidden;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none;">
                    <h6 class="m-0 font-weight-bold text-white"><i class="fas fa-map-marked-alt me-2"></i>Anschrift</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="small font-weight-bold text-gray-600 d-block">Straße / Nr.</label>
                            <span>{{ customer.street }} {{ customer.housenr }}</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="small font-weight-bold text-gray-600 d-block">PLZ / Ort</label>
                            <span>{{ customer.postal }} {{ customer.city }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-lg mb-4 border-0" style="border-radius: 15px; overflow: hidden;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                    <h6 class="m-0 font-weight-bold text-white"><i class="fas fa-calendar-check me-2"></i>Termine dieses Kunden</h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <tr>
                                    <th class="text-white border-0 py-3 px-4">Datum</th>
                                    <th class="text-white border-0 py-3">Anlass</th>
                                    <th class="text-white border-0 py-3">Location</th>
                                    <th class="text-white border-0 py-3 text-center">Status</th>
                                    <th class="text-white border-0 py-3 text-end px-4">Aktion</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for appt in customer.appointments %}
                                <tr class="{% if loop.index is odd %}bg-light{% endif %}" style="transition: all 0.2s ease;">
                                    <td class="py-3 px-4">
                                        <i class="fas fa-calendar me-2 text-muted"></i>
                                        <strong style="color: #4e73df;">{{ appt.date ? appt.date|date('d.m.Y') : '' }}</strong>
                                    </td>
                                    <td class="py-3">
                                        <i class="fas fa-star me-2 text-muted"></i>{{ appt.occasion }}
                                    </td>
                                    <td class="py-3">
                                        <i class="fas fa-map-marker-alt me-2 text-muted"></i>{{ appt.location.locationName|default('-') }}
                                    </td>
                                    <td class="text-center py-3">
                                        {% if appt.isConfirmed %}
                                            <span class="badge rounded-pill" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: #fff; padding: 0.4rem 0.8rem;">
                                                <i class="fas fa-check-circle me-1"></i>Bestätigt
                                            </span>
                                        {% else %}
                                            <span class="badge rounded-pill" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #fff; padding: 0.4rem 0.8rem;">
                                                <i class="fas fa-clock me-1"></i>Offen
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end py-3 px-4">
                                        <a href="{{ path('app_appointments_show', {'id': appt.id}) }}" 
                                           class="btn btn-sm shadow-sm" 
                                           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                                            <i class="fas fa-eye me-1"></i>Details
                                        </a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-5">
                                        <i class="fas fa-calendar-times fa-3x text-muted mb-3 d-block"></i>
                                        <p class="text-muted mb-0">Keine Termine gefunden</p>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-end mt-4 text-muted small">
                 {{ include('customer/_delete_form.html.twig') }}
            </div>
        </div>
    </div>
{% endblock %}
