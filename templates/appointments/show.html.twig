{% extends 'base.html.twig' %}

{% block title %}Appointments{% endblock %}
    {% block header %}
        {{ appointment.occasion ~ ' von ' ~ appointment.customer.prename ~ ' ' ~ appointment.customer.lastname ~ ' am ' ~ (appointment.date|date('d.m.Y')) }}
    {% endblock %}
{% block body %}

    {% set diff = 0 %}
    <div class="row">
        <div class="col-sm-12 col-md-6">
            <div class="table-container mt-4 mb-4">
                <h2>Informationen zur Location</h2>
                <table class="table">
                    <tbody>
                    <tr>
                        <td><a href="{{ path('app_location_show', { id: appointment.location.id }) }}" target="_blank">{{ appointment.location.locationName }}</a><br>
                            {{ appointment.location.street }} {{ appointment.location.streetnr }}<br>
                            {{ appointment.location.postal }} {{ appointment.location.city }}
                            <br><br>
                            <strong>Notizen zur Location</strong><br>
                            {{ appointment.location.notes }}<br><br></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-sm-12 col-md-6">
            <div class="table-container mt-4 mb-4">
                <h2>Informationen zum Kunden</h2>
                <table class="table">
                    <tbody>
                    <tr>
                        <td><a href="{{ path('app_customer_edit', { id: appointment.customer.id }) }}" target="_blank">{{ appointment.customer.prename }} {{ appointment.customer.lastname }}</a><br>
                            {{ appointment.customer.street }} {{ appointment.customer.housenr }}<br>
                            {{ appointment.customer.postal }} {{ appointment.customer.city }}<br><br>
                            <strong>Informationen zur Zahlung</strong><br>
                            {% if appointment.customer.requireCash == true %}
                            <span>Barzahlung erforderlich</span><br>
                            {% else %}
                            <span>{{ appointment.customer.payment.name }}</span><br>
                            {% endif %}
                            {{ appointment.customer.requirePrepaid ? "Vorkasse erforderlich" : "Keine Vorkasse erforderlich."}}</td>
                        </td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="table-container mb-4">
    <table class="table">
        <tbody>
            <tr>
                <th>Datum der Veranstaltung</th>
                <td>{{ appointment.date ? appointment.date|date('d.m.Y') : '' }}</td>
            </tr>
            <tr>
                <th>Beginn (Uhrzeit)</th>
                <td>{{ appointment.startTime ? appointment.startTime|date('H:i') : '' }} Uhr</td>
            </tr>
            <tr>
                <th>Ende (Uhrzeit)</th>
                <td>{{ appointment.endTime ? appointment.endTime|date('H:i') : '' }} Uhr</td>
            </tr>
            <tr>
                <th>Dauer</th>
                <td>
                    {% if appointment.startTime and appointment.endTime %}
                        {% set start = appointment.startTime|date('U') %}
                        {% set end = appointment.endTime|date('U') %}
                        {% if end < start %}
                            {% set end = end + 86400 %} {# +24h, wenn Ende nach Mitternacht liegt #}
                        {% endif %}
                        {% set diff = (end - start) / 3600 %}
                        {{ diff|round(0, 'floor') }} Stunden
                    {% endif %}
                </td>
            </tr>

            <tr>
                <th>Bestätigt?</th>
                <td>{{ appointment.isConfirmed ? 'Ja' : 'Nein' }}</td>
            </tr>
            <tr>
                <th>Aufbau geklärt?</th>
                <td>{{ appointment.setupWithLocation ? 'Ist abgeklärt' : 'Nicht abgeklärt' }}</td>
            </tr>
            <tr>
                <th>Abbau geklärt?</th>
                <td>{{ appointment.teardownWithLocation ? 'Ist abgeklärt' : 'Nicht abgeklärt'  }}</td>
            </tr>
            {% if appointment.setupWithLocation == false %}
            <tr>
                <th>Aufbau Datum</th>
                <td>{{ appointment.setupDate ? appointment.setupDate|date('d.m.Y') : '' }}</td>
            </tr>
            <tr>
                <th>Aufbau Zeit</th>
                <td>{{ appointment.setupTime ? appointment.setupTime|date('H:i') : '' }} Uhr</td>
            </tr>
            {% endif %}
            {% if appointment.teardownWithLocation == false %}
            <tr>
                <th>Abbau Datum</th>
                <td>{{ appointment.teardownDate ? appointment.teardownDate|date('d.m.Y') : '' }}</td>
            </tr>
            <tr>
                <th>Abbau Zeit</th>
                <td>{{ appointment.teardownTime ? appointment.teardownTime|date('H:i') : '' }} Uhr</td>
            </tr>
            {% endif %}
            <tr>
                <th>Gäste</th>
                <td>{{ appointment.attendeesCount }}</td>
            </tr>
            <tr>
                <th>Gästealter von</th>
                <td>{{ appointment.attendeesAgeFrom }}</td>
            </tr>
            <tr>
                <th>Gästealter bis</th>
                <td>{{ appointment.attendeesAgeTo }}</td>
            </tr>
            <tr>
                <th>Informationen zu den Gästen</th>
                <td>{{ appointment.attendeesNotes }}</td>
            </tr>
            <tr>
                <th>Musikfragebogen PDF</th>
                <td>{{ appointment.musicPdfPath ? 'Hinterlegt' : 'Nicht hinterlegt' }}</td>
            </tr>
            <tr>
                <th>Notizen für den DJ</th>
                <td>{{ appointment.djNotes }}</td>
            </tr>
            <tr>
                <th>DJ Preis (Stunde)</th>
                <td>{{ appointment.priceDjHour }} €/Stunde</td>
            </tr>
            <tr>
                <th>Verlängerung / Stunde</th>
                <td>{{ appointment.priceDjExtention }} €/Stunde</td>
            </tr>
            <tr>
                <th>Preis Technik</th>
                <td>{{ appointment.priceTech }} €</td>
            </tr>
            {% if appointment.priceApproach > 0 %}
            <tr>
                <th>Anfahrtskosten</th>
                <td>{{ appointment.priceApproach }} €</td>
            </tr>
            {% endif %}
            <tr style="border-top: 2px dashed #43A4CE;">
                <th>Gesamtkosten</th>
                <td>{{ (appointment.priceDjHour*diff)+appointment.priceTech+appointment.priceApproach }} €</td>
            </tr>
        </tbody>
    </table>
    </div>
    <div class="row">
        <div class="col-12">
            <a class="special-link" href="{{ path('app_appointments_index') }}">Alle Termine ansehen</a>
            <a class="special-link" href="{{ path('app_appointments_edit', {'id': appointment.id}) }}">Termin bearbeiten</a>
        </div>
    </div>
    <div class="mb-5"></div>
{% endblock %}
